<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bunk & Bite | Your Tray</title>
    <link rel="icon" type="image/x-icon" href="static/photos/favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&family=Inter:wght@400;700&family=Permanent+Marker&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
        theme: {
            extend: {
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                    varsity: ['Alfa Slab One', 'cursive'],
                    doodle: ['Permanent Marker', 'cursive'],
                },
                colors: {
                    'varsity-red': '#c92a2a',
                    'varsity-yellow': '#fab005',
                    'varsity-blue': '#1864ab',
                    'paper-cream': '#f4f1e8',
                    'ink-black': '#212529',
                },
                backgroundImage: {
                    'paper-texture': "url('https://www.transparenttextures.com/patterns/crumpled-paper.png')",
                    'notebook-lines': "repeating-linear-gradient(transparent, transparent 31px, #e9ecef 31px, #e9ecef 32px)",
                },
                boxShadow: {
                    'sticker': '4px 4px 0px 0px #212529',
                    'polaroid': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 0 0 2px #212529',
                }
            }
        }
    }
  </script>

  <style>
    body {
        background-color: #f4f1e8;
        background-image: url('https://www.transparenttextures.com/patterns/crumpled-paper.png');
        color: #212529;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 10px; }
    ::-webkit-scrollbar-track { background: #f4f1e8; border-left: 2px solid #212529; }
    ::-webkit-scrollbar-thumb { background: #212529; border: 2px solid #f4f1e8; }
    ::-webkit-scrollbar-thumb:hover { background: #c92a2a; }

    /* Sidebar Active */
    .sidebar-active {
        background-color: #fab005 !important;
        color: #212529 !important;
        border: 2px solid #212529;
        box-shadow: 4px 4px 0px 0px #212529;
        transform: translate(-2px, -2px);
    }

    /* Animation */
    @keyframes sticker-pop {
        from { opacity: 0; transform: translateY(20px) rotate(1deg); }
        to { opacity: 1; transform: translateY(0) rotate(0deg); }
    }
    .animate-up {
        animation: sticker-pop 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    /* Receipt jagged edge pattern */
    .jagged-bottom {
        position: relative;
    }
    .jagged-bottom:after {
        content: "";
        display: block;
        position: absolute;
        bottom: -10px;
        left: 0;
        width: 100%;
        height: 10px;
        background: linear-gradient(45deg, transparent 33.333%, #ffffff 33.333%, #ffffff 66.667%, transparent 66.667%), linear-gradient(-45deg, transparent 33.333%, #ffffff 33.333%, #ffffff 66.667%, transparent 66.667%);
        background-size: 20px 40px;
    }
  </style>
</head>

<body class="flex min-h-screen relative font-sans">

  <aside class="w-20 lg:w-64 bg-varsity-blue border-r-4 border-ink-black flex flex-col fixed h-full z-40 overflow-y-auto transition-all duration-300">
    <div class="p-6 flex items-center gap-3 shrink-0 h-24 border-b-4 border-ink-black bg-varsity-blue text-white">
<div class="w-12 h-12 bg-varsity-yellow rounded-full border-4 border-ink-black flex items-center justify-center text-ink-black font-varsity text-2xl group-hover:rotate-12 transition-transform">
                        B&B</div>      <span class="hidden lg:block font-varsity text-2xl tracking-wide uppercase" style="text-shadow: 2px 2px 0 #000;">Bunk & Bite</span>
    </div>

    <nav class="flex-grow mt-6 px-4 pb-20 space-y-4">
      <div>
        <p class="hidden lg:block text-xs font-doodle text-white/80 uppercase px-2 mb-2 tracking-widest rotate-1">-- The Goods --</p>
        <a href="/user_home" class="flex items-center gap-3 p-3 rounded-lg text-white hover:text-varsity-yellow hover:translate-x-1 transition group font-varsity uppercase tracking-wide">
          <i class="fas fa-book-open w-6"></i>
          <span class="hidden lg:block text-sm">The Menu</span>
        </a>
        <a href="/my_orders" class="sidebar-active flex items-center gap-3 p-3 rounded-lg text-ink-black transition group font-varsity uppercase tracking-wide">
          <i class="fas fa-receipt w-6"></i>
          <span class="hidden lg:block text-sm">Tray & Orders</span>
        </a>
      </div>

      <div class="mt-8 pt-6 border-t-2 border-dashed border-white/20">
        <p class="hidden lg:block text-xs font-doodle text-white/80 uppercase px-2 mb-2 tracking-widest rotate-1">-- Student ID --</p>
        <a href="/my_profile" class="flex items-center gap-3 p-3 rounded-lg text-white hover:text-varsity-yellow hover:translate-x-1 transition group font-varsity uppercase tracking-wide">
          <i class="fas fa-user-circle w-6"></i>
          <span class="hidden lg:block text-sm">ID Card</span>
        </a>
        <a href="/logout" class="flex items-center gap-3 p-3 rounded-lg text-red-200 hover:text-white hover:bg-varsity-red border-2 border-transparent hover:border-ink-black transition group mt-2 font-bold font-sans">
          <i class="fas fa-sign-out-alt w-6"></i>
          <span class="hidden lg:block text-sm">Dropout (Exit)</span>
        </a>
      </div>
    </nav>
  </aside>

  <main class="ml-20 lg:ml-64 flex-grow relative">

    <header class="h-20 bg-paper-cream/90 backdrop-blur-sm border-b-4 border-ink-black flex items-center justify-between px-8 sticky top-0 z-30 shadow-sm">
      <div class="flex items-center gap-2 text-sm transform -rotate-1">
        <span class="text-varsity-red font-doodle text-xl font-bold">Review</span>
        <span class="text-ink-black font-varsity text-xl uppercase">Your Stash</span>
      </div>

      <div class="flex items-center gap-6">
        <div class="flex items-center gap-3 text-right">
          <div class="hidden md:block leading-tight">
             <div class="text-lg font-varsity text-ink-black">{{ username }}</div>
            <div class="text-xs text-varsity-blue font-doodle">Active Eater</div>
          </div>
          <div class="w-10 h-10 rounded-full bg-varsity-yellow border-2 border-ink-black flex items-center justify-center text-ink-black shadow-[2px_2px_0px_0px_#000]">
            <i class="fas fa-user"></i>
          </div>
        </div>
      </div>
    </header>

    <div class="p-6 md:p-10 max-w-6xl mx-auto pb-32">

      {% if cart_items %}

      <div class="mb-10 bg-white border-4 border-ink-black rounded-sm p-8 relative shadow-sticker animate-up transform rotate-1 jagged-bottom">

        <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 w-32 h-8 bg-white/50 border border-gray-300 rotate-2 z-10 box-shadow"></div>

        <div class="flex flex-col md:flex-row justify-between items-center gap-6 relative z-0">
            <div class="flex items-center gap-5 w-full md:w-auto p-4 border-2 border-dashed border-gray-300 bg-gray-50 rounded">
                <div class="w-12 h-12 rounded-full bg-varsity-blue text-white flex items-center justify-center border-2 border-ink-black">
                    <i class="fas fa-wallet text-xl"></i>
                </div>
                <div>
                    <p class="text-xs text-gray-500 uppercase font-bold tracking-widest mb-1 font-varsity">Wallet Funds</p>
                    <p class="text-2xl font-bold text-ink-black font-doodle">₹{{ balance }}</p>
                </div>
            </div>

            <div class="h-12 w-1 bg-ink-black hidden md:block transform rotate-12"></div>

            <div class="flex items-center gap-5 w-full md:w-auto">
                <div class="text-right">
                    <p class="text-sm text-ink-black uppercase font-bold tracking-widest mb-1 font-varsity">Total Damage</p>
                    <p class="text-4xl font-bold text-varsity-red font-doodle transform -rotate-2 underline decoration-wavy decoration-ink-black">₹<span id="grand-total">{{ total_amount }}</span></p>
                </div>
            </div>
        </div>

        {% if not can_place %}
        <div class="mt-8 p-4 bg-varsity-red text-white border-4 border-ink-black flex items-center gap-3 font-bold font-varsity uppercase tracking-wide transform -rotate-1 shadow-sm">
            <i class="fas fa-exclamation-triangle text-varsity-yellow"></i>
            <span>Broke Alert: Add money to wallet first!</span>
        </div>
        {% endif %}
      </div>

      <div class="bg-white border-4 border-ink-black shadow-sticker mb-10 animate-up overflow-hidden" style="animation-delay: 0.1s;">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-varsity-blue text-white uppercase tracking-widest border-b-4 border-ink-black">
                    <th class="py-4 px-6 font-varsity text-lg">Item</th>
                    <th class="py-4 px-6 text-center font-varsity text-lg">Qty</th>
                    <th class="py-4 px-6 text-right font-varsity text-lg">Price</th>
                    <th class="py-4 px-6 text-right font-varsity text-lg">Total</th>
                </tr>
            </thead>
            <tbody class="divide-y-2 divide-gray-200">
                {% for item in cart_items %}
                <tr class="group hover:bg-paper-cream transition-colors" id="row-{{ item.item_id }}">
                    <td class="py-4 px-6">
                        <div class="flex items-center gap-4">
                            <div class="p-1 bg-white border-2 border-ink-black shadow-sm transform -rotate-2 group-hover:rotate-0 transition-transform">
                                <img src="{{ url_for('static', filename='item_photos/' ~ item.photo) }}"
                                     class="w-16 h-16 object-cover grayscale group-hover:grayscale-0 transition-all duration-300"
                                     alt="Food Image">
                            </div>
                            <div>
                                <h3 class="font-bold text-ink-black text-lg font-varsity leading-tight uppercase">{{ item.name }}</h3>
                                <span class="inline-block mt-1 px-2 py-0.5 bg-varsity-yellow text-ink-black text-[10px] font-bold uppercase tracking-wider border-2 border-ink-black transform rotate-1">
                                    {{ item.type }}
                                </span>
                            </div>
                        </div>
                    </td>

                    <td class="py-4 px-6">
                        <div class="flex items-center justify-center gap-3">
                            <div class="w-10 h-10 border-2 border-ink-black rounded-full flex items-center justify-center bg-white">
                                <span id="qty-{{ item.item_id }}" class="font-doodle font-bold text-ink-black text-xl">
                                    {{ item.quantity }}
                                </span>
                            </div>
                        </div>
                    </td>

                    <td class="py-4 px-6 text-right text-gray-500 font-doodle text-lg">
                        ₹{{ item.price }}
                    </td>
                    <td class="py-4 px-6 text-right font-bold text-varsity-red text-xl font-doodle transform -rotate-1">
                        ₹<span id="subtotal-{{ item.item_id }}">{{ item.subtotal }}</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
      </div>

      <div class="flex flex-col md:flex-row gap-5 items-center justify-end animate-up" style="animation-delay: 0.2s;">
          <a href="/user_home" class="px-8 py-4 font-bold font-doodle text-lg hover:text-varsity-blue hover:underline decoration-wavy decoration-2 transition-all duration-300 flex items-center gap-2">
              <i class="fas fa-arrow-left"></i> Forget something?
          </a>

          <form method="POST" action="/order" class="w-full md:w-auto" id="order-form">
            {% for item in cart_items %}
            <div class="hidden-inputs-{{ item.item_id }}">
                <input type="hidden" value="{{ item.name }}" name="food_name"/>
                <input type="hidden" value="{{ item.quantity }}" name="quantity" id="input-qty-{{ item.item_id }}"/>
                <input type="hidden" value="{{ item.subtotal }}" name="total_price" id="input-total-{{ item.item_id }}"/>
                <input type="hidden" value="{{ item.type }}" name="type"/>
                <input type="hidden" value="{{ item.item_id }}" name="item_id"/>
                <input type="hidden" value="{{ id }}" name="st_id"/>
            </div>
            {% endfor %}

            <button type="submit"
                {% if not can_place %}
                disabled
                class="w-full md:w-auto px-12 py-4 bg-gray-300 border-4 border-gray-400 text-gray-500 font-bold font-varsity rounded-none cursor-not-allowed flex items-center justify-center gap-2 uppercase tracking-wide"
                {% else %}
                class="w-full md:w-auto px-12 py-4 bg-varsity-red hover:bg-white hover:text-varsity-red text-white font-bold border-4 border-ink-black shadow-[6px_6px_0px_0px_#212529] hover:shadow-[2px_2px_0px_0px_#212529] hover:translate-x-1 hover:translate-y-1 transition-all duration-200 flex items-center justify-center gap-2 font-varsity tracking-wider uppercase text-xl"
                {% endif %}>
                <span>Lock It In</span>
                <i class="fas fa-arrow-right"></i>
            </button>
          </form>
      </div>

      {% else %}

      <div class="min-h-[60vh] flex flex-col items-center justify-center text-center bg-white border-4 border-ink-black shadow-sticker rounded-sm p-10 rotate-1 relative">
          <div class="absolute -top-4 w-40 h-10 bg-white/40 border border-gray-400 rotate-2"></div>

          <div class="w-32 h-32 bg-paper-cream border-4 border-ink-black rounded-full flex items-center justify-center mb-6 animate-pulse">
              <i class="fas fa-shopping-basket text-5xl text-ink-black/50"></i>
          </div>
          <h2 class="text-4xl font-bold font-varsity text-ink-black mb-2 uppercase">Tray Empty!</h2>
          <p class="text-xl font-doodle text-gray-500 mb-8 max-w-md transform -rotate-1">"You can't study on an empty stomach."</p>
          <a href="/user_home" class="px-8 py-3 bg-varsity-yellow text-ink-black border-2 border-ink-black shadow-[4px_4px_0px_0px_#212529] hover:shadow-none hover:translate-x-1 hover:translate-y-1 font-varsity uppercase tracking-widest transition-all duration-200">
              Go To Menu ->
          </a>
      </div>

      {% endif %}

    </div>
  </main>

  <script>
      // Logic unchanged
      function updateTrayItem(itemId, action, price) {
          console.warn("Client-side quantity modification is disabled for item:", itemId);
      }
  </script>
</body>
</html>